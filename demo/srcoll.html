<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>下拉自动加载</title>
		<link rel="stylesheet" href="" />
		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lte IE 8]>
			<script src="../../js/html5shiv.js" type="text/javascript" charset="utf-8"></script>
			<script src="../../js/respond.min.js" type="text/javascript" charset="utf-8"></script>
		<![endif]-->

		<style type="text/css">
			@charset "utf-8";
			* {
				padding: 0;
				margin: 0;
			}
			
			.container {
				width: 1200px;
				margin: 0 auto;
				height: 20px;
				border: 1px solid red;
			}
			
			table {
				table-layout: auto;
				border-collapse: collapse;
				border: 1px solid red;
				margin-bottom: 20px;
			}
			
			table tr td {
				padding: 10px;
				border: 1px solid red;
			}
			
			ul {
				list-style: none;
			}
			
			ul li {
				margin-bottom: 20px;
				line-height: 30px;
			}
			
			.scroll-content {
				height: 60%;
				width: 100%;
				box-sizing: border-box;
				overflow-y: auto;
				background: #fff;
				-webkit-transition: .5s;
				transition: .5s;
			}
			
			.scroll-content-box {
				padding: 10px;
			}
			
			.scroll-handler {
				padding: 10px;
				background: #f0f0f0;
				color: #444;
				text-align: center;
			}
		</style>

	</head>

	<body>
		<div class="scroll-content">

			<ul class="scroll-content-box">

				<li>
					让房价调控更令人宽心 算好污染防治账
				</li>
				<li>
					让房价调控更令人宽心 算好污染防治账
				</li>
				<li>
					让房价调控更令人宽心 算好污染防治账
				</li>
				<li>
					让房价调控更令人宽心 算好污染防治账
				</li>
				<li>
					让房价调控更令人宽心 算好污染防治账
				</li>
				<li>
					让房价调控更令人宽心 算好污染防治账
				</li>
				<li>
					让房价调控更令人宽心 算好污染防治账
				</li>

			</ul>

			<!--下拉加载title-->
			<div class="scroll-handler">点击加载更多</div>

		</div>

		<script src="js/jquery-1.11.0.js" type="text/javascript" charset="utf-8"></script>
	
		<script type="text/javascript">
			$(function() {
				srollTop.init({
					
					pageIndex:1, // 当前页
					pageMax:10,  // 最大页码
					textLoad:"正在加载中...",
					textEnd:"没有更多数据",
					textClick:"点击加载更多",
					callback: function(el,pageIndex) {   // 回调函数
						var list = document.createDocumentFragment();
						for(var i = 0; i < 10; i++) {
							var li = document.createElement("li");

							li.innerHTML = (i + 1) + "========" + pageIndex + "==========";

							list.appendChild(li)
						}
						el.appendChild(list);
					}
				});
			});
			
			
			
			
			var srollTop = (function() {

				function initPage(options) {
					var list = document.querySelectorAll(".scroll-content");
					for(var i = 0; i < list.length; i++) {
						scrollItem(list[i], options);
					}

					function scrollItem(item, options) {
						var wndow_h = window.innerHeight || window.document.documentElement.clientHeight || window.document.body.clientHeight;
						wndow_h = Number(wndow_h);
						var pageIndex = options.pageIndex; //当前页
						var pageMax = options.pageMax; //最大页码
						var isbl = true;
						var setTimeoutId = 0;
						var load = item.querySelector(".scroll-handler") || $(".scroll-handler")[0];

						//
						if(pageIndex >= pageMax) {
							load.innerHTML =options.textEnd?options.textEnd:"...已到底了...";
							return;
						}

						// document不能scroll 就点击click
						onEvent(load, "click", function() {

							clearTimeout(setTimeoutId);

							if(wndow_h >= load.offsetTop) {

								pageIndex++;
								loadData(pageIndex, options.callback);
							}
							load.innerHTML = options.textClick?options.textClick:"...点击加载更多...";

						});

						// document scroll event
						onEvent(window, "scroll", function(event) {

							load.innerHTML =options.textLoad?options.textLoad: "正在加载中...";
							if(pageIndex >= pageMax) {
								load.innerHTML = options.textEnd?options.textEnd:"...已到底了...";
								return;
							}
							var load_offset_top = Number(load.offsetTop);
							var window_scroll_top = Number(window.scrollY || window.pageYOffset)
							if(isNaN(window_scroll_top)) {
								window_scroll_top = Number($(window).scrollTop())
							}

							window_scroll_top = window_scroll_top + Number(load.offsetHeight);

							var load_top = (load_offset_top - wndow_h);

							if((window_scroll_top >= load_top) && isbl) {

								clearTimeout(setTimeoutId);
								isbl = false;
								setTimeoutId = setTimeout(function() {
									pageIndex++;
									loadData(pageIndex, options.callback);

								}, 1000);

							}

						});

						function loadData(count, callback) {

							var content = item.querySelector(".scroll-content-box") || $(".scroll-content-box")[0];

							//							var list = document.createDocumentFragment();
							//							for(var i = 0; i < 10; i++) {
							//								var el = document.createElement("li");
							//
							//								el.innerHTML = (i + 1) + "========" + count + "==========";
							//
							//								list.appendChild(el)
							//							}
							//							content.appendChild(list);

							callback(content,count);
							isbl = true;

						}

					}

				}

				/**bing事件**/
				function onEvent(el, type, handler) {

					if(el.addEventListener) {
						el.addEventListener(type, handler);
					} else if(el.attachEvent) {
						if(!el.attachEvent("on" + type, handler)) {
							window["on" + type] = handler;
						}

					}
				}

				function offEvent(el, type, handler) {

					if(el.removeEventListener) {
						el.removeEventListener(type, handler);
					} else if(el.detachEvent) {
						el.detachEvent("on" + type, handler)

					}
				}

				return {
					init: initPage
				}

			})();
		
		</script>

	</body>

</html>